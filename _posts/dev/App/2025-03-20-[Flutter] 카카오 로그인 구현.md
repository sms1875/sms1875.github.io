---
layout: post
title: "[Flutter] ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„"
date: 2025-03-20 23:17:00+0900
categories: [Dev, App]
tags: [App, flutter]
mermaid: true
---
## ì„¤ê³„

ì¹´ì¹´ì˜¤ë¡œê·¸ì¸ì„ ì´ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•  í•„ìš” ì—†ì´ íšŒì›ê°€ì…/ë¡œê·¸ì¸ì„ ìˆ˜í–‰í•œë‹¤

```mermaid
%%{init: {
  'theme': 'base', 
  'themeVariables': {
    'primaryColor': '#F8F9FA',
    'primaryTextColor': '#333',
    'primaryBorderColor': '#005792',
    'lineColor': '#005792',
    'secondaryColor': '#E5F0F9',
    'tertiaryColor': '#F8F9FA',
    'fontSize': '16px',
    'actorBkg': '#E8F4EA',
    'actorBorder': '#2E8B57',
    'actorTextColor': '#2E8B57',
    'actorLineColor': '#2E8B57',
    'noteBkgColor': '#FFF3E0',
    'noteBorderColor': '#E67E22',
    'noteTextColor': '#E67E22',
    'activationBorderColor': '#005792',
    'activationBkgColor': '#E5F0F9',
    'sequenceNumberColor': '#005792'
  }
}}%%

sequenceDiagram
    participant User as ğŸ‘¤ ì‚¬ìš©ì
    participant App as ğŸ“± ì•±
    participant Kakao as ğŸ”‘ ì¹´ì¹´ì˜¤ ì„œë²„
    participant Server as ğŸ–¥ï¸ ë°±ì—”ë“œ ì„œë²„
    
    User->>App: ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­
    App->>Kakao: ì¹´ì¹´ì˜¤ SDK ì¸ì¦ ìš”ì²­
    Note over App,Kakao: KakaoService.authenticate()
    
    alt ì¹´ì¹´ì˜¤í†¡ ì„¤ì¹˜ë¨
        Kakao->>User: ì¹´ì¹´ì˜¤í†¡ ì•±ìœ¼ë¡œ ì¸ì¦ ìš”ì²­
        User->>Kakao: ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ì¸ì¦ ì™„ë£Œ
    else ì¹´ì¹´ì˜¤í†¡ ë¯¸ì„¤ì¹˜
        Kakao->>User: ì›¹ ë¸Œë¼ìš°ì €ë¡œ ì¸ì¦ ìš”ì²­
        User->>Kakao: ì›¹ ë¸Œë¼ìš°ì €ë¡œ ì¸ì¦ ì™„ë£Œ
    end
    
    Kakao-->>App: ì‚¬ìš©ì ì •ë³´ ë°˜í™˜ (User ê°ì²´)
    Note over App: ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ (ì´ë¦„, ì´ë©”ì¼, ìƒë…„ì›”ì¼, ì„±ë³„)
    
    App->>Server: ì„œë²„ ì¸ì¦ ìš”ì²­ (KakaoAuthRequest)
    Note over App,Server: AuthService.authenticateWithServer()
    
    alt ìµœì´ˆ ë¡œê·¸ì¸
        Server->>Server: íšŒì›ê°€ì… ì²˜ë¦¬
    else ê¸°ì¡´ íšŒì›
        Server->>Server: ë¡œê·¸ì¸ ì²˜ë¦¬
    end
    
    Server-->>App: ì¸ì¦ ì‘ë‹µ (KakaoAuthResponse)
    Note over App,Server: í† í° ë° ì‚¬ìš©ì ì •ë³´ í¬í•¨
    
    App->>App: í† í° ì €ì¥ (TokenManager)
    Note over App: accessToken, refreshToken ì €ì¥
    
    App->>User: ë¡œê·¸ì¸ ì™„ë£Œ ë° ë©”ì¸ í™”ë©´ í‘œì‹œ
```

## í”Œë«í¼ ë“±ë¡

ìì‹ ì´ ì‚¬ìš©í•  í”Œë«í¼ì„ ë“±ë¡í•œë‹¤

ìš°ì„  ì•ˆë“œë¡œì´ë“œë¡œë§Œ ë“±ë¡í–ˆë‹¤

`ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ì•± ì„¤ì • â†’ í”Œë«í¼`

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image.png)

ë“±ë¡ í›„ ëª¨ìŠµ

í‚¤ í•´ì‹œëŠ” ê°œë°œìš©ì—ì„œëŠ” ë””ë²„ê·¸ìš© í‚¤ë§Œ ì…ë ¥í•´ë„ ì¶©ë¶„í•˜ë‹¤ê³  í•œë‹¤

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%201.png)

## ì•± í‚¤ ì„¤ì •

kakao developersì— ë“±ë¡í•œ ë‚´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì•± í‚¤ë¥¼ í™•ì¸í•´ì•¼ í•œë‹¤ 

`ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ì•± ì„¤ì • â†’ ì•± í‚¤`

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%202.png)

flutterì—ì„œëŠ” dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ì„œ í‚¤ë¥¼ ê´€ë¦¬í•˜ì˜€ë‹¤

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%203.png)

ì•ˆë“œë¡œì´ë“œì—ì„œë„ .env ì•ˆì˜ ê°’ì„ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì—ˆì§€ë§Œ ì‹¤íŒ¨í–ˆë‹¤

ê·¸ë˜ì„œ ìš°ì„  propertiesì— ì¶”ê°€ë¡œ ì‘ì„±í•˜ê³ , app ìˆ˜ì¤€ì˜ build.gradleì—ì„œ ì½ì–´ì™€ì„œ ì‚¬ìš©í•˜ë„ë¡ í–ˆë‹¤

`android\local.properties`

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%204.png)

`android\app\build.gradle.kts`

```kotlin
import com.android.build.gradle.internal.cxx.configure.gradleLocalProperties // ì¶”ê°€
// ...

android {
    // ... 

    defaultConfig {
        minSdk = flutter.minSdkVersion
        targetSdk = flutter.targetSdkVersion
        versionCode = flutter.versionCode
        versionName = flutter.versionName
        
        // ...
        
        // kakao app key ì„¤ì •
        val properties = gradleLocalProperties(rootProject.projectDir, providers)
        manifestPlaceholders["KAKAO_APP_KEY"] = properties.getProperty("kakao.app.key", "")
    }
    // ...
}
```

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%205.png)

ìœ„ì—ì„œ ë“±ë¡í•œ `KAKAO_APP_KEY`ë¥¼ ì´ìš©í•˜ì—¬ **ì»¤ìŠ¤í…€ URL ìŠ¤í‚´**ì„ ì„¤ì •í•œë‹¤

`android\app\src\main\AndroidManifest.xml`

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%206.png)

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%207.png)

## ë™ì˜í•­ëª© ì„¤ì •

ì¹´ì¹´ì˜¤ì¸ì¦ì„í†µí•´ ê°€ì ¸ì˜¬ ì •ë³´ë“¤ì˜ ê¶Œí•œ ë™ì˜ ì„¤ì •ì„ í•œë‹¤

ì—¬ê¸°ì„œ ë™ì˜í•œ í•­ëª©ì„ ë‚˜ì¤‘ì— `kakaoAccount.name` ì²˜ëŸ¼ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%208.png)

## Flutter êµ¬í˜„

1. kakao sdk ì„¤ì¹˜
    
    ```kotlin
    flutter pub add kakao_flutter_sdk_user
    ```
    

2. main() ì´ˆê¸°í™” ë¡œì§ êµ¬í˜„
    
    ì•± í‚¤ë¥¼ ê°€ì ¸ì™€ì„œ nativeAppKey íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•´ì¤€ë‹¤
    
    ```dart
    Future<void> main() async {
      WidgetsFlutterBinding.ensureInitialized();
    
      // .env íŒŒì¼ ë¡œë“œ
      await dotenv.load(fileName: ".env");
      // kakao sdk ì´ˆê¸°í™”
      KakaoSdk.init(nativeAppKey: dotenv.env['KAKAO_APP_KEY'] ?? '');
    
      runApp(const ProviderScope(child: MyApp()));
    }
    ```
    

3. ì„œë¹„ìŠ¤ êµ¬í˜„
    
    ì¹´ì¹´ì˜¤í†¡ ì„¤ì¹˜ ìœ ë¬´ì— ë”°ë¼ `loginWithKakaoTalk` ì™€ `loginWithKakaoAccount` ë¡œ ë¶„ë¦¬í•˜ì—¬ ì¸ì¦ì„ ìˆ˜í–‰í•œë‹¤
    
    ```dart
    import 'package:flutter_riverpod/flutter_riverpod.dart';
    import 'package:kakao_flutter_sdk_user/kakao_flutter_sdk_user.dart';
    
    class KakaoService {
      /// ì¹´ì¹´ì˜¤ SDKë¥¼ í†µí•œ ì¸ì¦
      Future<User> authenticate() async {
        try {
          final installed = await isKakaoTalkInstalled();
          if (installed) {
            await UserApi.instance.loginWithKakaoTalk();
          } else {
            await UserApi.instance.loginWithKakaoAccount();
          }
    
          return await UserApi.instance.me();
        } catch (error) {
          print('ì¹´ì¹´ì˜¤ ì¸ì¦ ì‹¤íŒ¨: $error');
          throw Exception('ì¹´ì¹´ì˜¤ ì¸ì¦ ì‹¤íŒ¨: $error');
        }
      }
    
      /// ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ
      Future<void> logout() async {
        try {
          await UserApi.instance.logout();
        } catch (error) {
          print('ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: $error');
          throw Exception('ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: $error');
        }
      }
    }
    
    final kakaoServiceProvider = Provider<KakaoService>((ref) {
      return KakaoService();
    });
    
    ```
    

4. ì‚¬ìš©ì ì •ë³´ë¥¼ í†µí•œ ì„œë²„ ì¸ì¦
    1. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ìˆ˜í–‰
    2. ì¹´ì¹´ì˜¤ ê³„ì •ì—ì„œ ë™ì˜ í•­ëª©ìœ¼ë¡œ ì„¤ì •í•œ ì •ë³´(`kakaoUser.kakaoAccount?.name` ë“±) ì¶”ì¶œ
    3. ì„œë²„ ì¸ì¦ ìˆ˜í–‰
    
    ```dart
    /// ì„œë²„ ë¡œê·¸ì¸/íšŒì›ê°€ì…
    Future<KakaoAuthResponse> authenticateWithServer(User kakaoUser) async {
      try {
        final request = KakaoAuthRequest(
          name: kakaoUser.kakaoAccount?.name ?? '',
          email: kakaoUser.kakaoAccount?.email ?? '',
          birthyear: kakaoUser.kakaoAccount?.birthyear ?? '',
          birthday: kakaoUser.kakaoAccount?.birthday ?? '',
          gender: kakaoUser.kakaoAccount?.gender?.toString().toLowerCase() ?? '',
          providerId: kakaoUser.id.toString(),
        );
    		
    		// ì„œë²„ ì¸ì¦ ìš”ì²­
        return await _authRepository.signInWithKakao(request);
      } catch (error) {
        print('ì„œë²„ ì¸ì¦ ì‹¤íŒ¨: $error');
        throw Exception('ì„œë²„ ì¸ì¦ ì‹¤íŒ¨: $error');
      }
    }
    
    /// í†µí•© ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤
    Future<KakaoAuthResponse> signInWithKakao() async {
      try {
        // ì¹´ì¹´ì˜¤ ì¸ì¦
        final kakaoUser = await _kakaoService.authenticate();
    
        // ì„œë²„ ì¸ì¦
        return await authenticateWithServer(kakaoUser);
      } catch (error) {
        print('ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ì‹¤íŒ¨: $error');
        throw Exception('ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤ ì‹¤íŒ¨: $error');
      }
    }
    ```
    

- ì²˜ìŒ ë¡œê·¸ì¸ ì‹œ ê¶Œí•œ ìš”ì²­ í™”ë©´

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%209.png)

- ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë©´ ë°”ë¡œ ë¡œê·¸ì¸ì´ ê°€ëŠ¥í•˜ë‹¤

![image.png](assets/img/posts/dev/App/ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ êµ¬í˜„/image%2010.png)

## reference

1. [https://developers.kakao.com/docs/latest/ko/kakaologin/flutter](https://developers.kakao.com/docs/latest/ko/kakaologin/flutter) 
2. [https://velog.io/@iamjm29/Android-í‚¤í•´ì‹œkey-hash-ì¶”ì¶œí•˜ê¸°](https://velog.io/@iamjm29/Android-%ED%82%A4%ED%95%B4%EC%8B%9Ckey-hash-%EC%B6%94%EC%B6%9C%ED%95%98%EA%B8%B0)
